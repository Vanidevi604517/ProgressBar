<!DOCTYPE html>
<html lang="en">
<head>
 <title>Front End Assignment - Progress Bars</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="styles.css">
</head>
<body style="background-color:black;">
	<div class="container">
	  <div class="row">
	  	<div class="col-sm-4 col-md-4 col-lg-4"></div>
	  	<div class="col-sm-4 col-md-4 col-lg-4 progressDemo">
			<h2 class="hcls">Progress Bar Demo</h2>
			<span id="id02"></span>
			<select class="bootstrap-select" id="p1"></select>
			<span id="id01"></span>
		</div>
	  	<div class="col-sm-4 col-md-4 col-lg-4"></div>
	  </div>
	</div>
</body>
<script src="code.min.js"></script>
<script>
var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200) {
		 var myArr = JSON.parse(this.responseText);
		 createButtons(myArr);
		 createBar(myArr);
		}
	};
	xhttp.open("GET", "http://pb-api.herokuapp.com/bars", true);
	xhttp.send();
	function createButtons(arr) {
		var buttons = arr.buttons;
		var limit = arr.limit;
		var out = "";
		var i;
		var vals = Object.keys(buttons).map(function(key) {
			return out +='<button type="button" class="btn btn-sm btn-outline-secondary btcls" data-value="'+limit+'"  id="'+buttons[key]+'" onclick="barAnimation(this.id);">'+buttons[key]+'</button>';
		});
	    document.getElementById("id01").innerHTML = out;
    }

	function createBar(arr) {
			var bars = arr.bars;
			var out = "";
			var i;                                                                              
			pSelect = document.getElementById('p1');
			
			var vals = Object.keys(bars).map(function(key) {
				pSelect.options[pSelect.options.length] = new Option('Progress '+(Number(key)+1), bars[key]);
				return out +='<div class="progress brcls"><div class="progress-bar" id="barID_'+key+'" style="width:'+bars[key]+'%;">'+bars[key]+'</div></div><br>';
			});
			
			<!-- for(i = 0; i < Object.keys(bars).length; i++) { -->
				<!-- out +='<div class="progress brcls"><div class="progress-bar" id="barID_'+i+'" style="width:'+Object.values(bars)[i]+'%;">'+Object.values(bars)[i]+'</div></div><br>'; -->
				<!-- pSelect.options[pSelect.options.length] = new Option('Progress '+(i+1), Object.values(bars)[i]); -->
                <!-- if(i==0)pSelect.options[i].selected = true; -->
		  <!-- } -->
			document.getElementById("id02").innerHTML = out;
	}
	
	function barAnimation(buttonValue) {
		var limit = document.getElementById(buttonValue).getAttribute('data-value');
		var selectedProgress = document.getElementById("p1").options[document.getElementById("p1").selectedIndex].text;
		var progress = selectedProgress.match(/\d/g).join("");
		var barValue = document.getElementById("barID_"+(progress-1)).innerHTML.replace(/[^a-zA-Z0-9 ]/g, ""); 
		
		if((Number(barValue) + Number(buttonValue)) >= 0 ) { 
			document.getElementById("barID_"+(progress-1)).style.width =  Number(barValue) + Number(buttonValue)+'%';
			document.getElementById("barID_"+(progress-1)).innerHTML = Number(barValue) + Number(buttonValue)+'%';
			if((Number(barValue) + Number(buttonValue)) > limit) {
				document.getElementById("barID_"+(progress-1)).classList.add("bg-danger");
			} else {
				document.getElementById("barID_"+(progress-1)).classList.remove("bg-danger");
			}
		} else {
			alert('Bar should not be less than 0');
		}
		
	} 
</script>
</html>